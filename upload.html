<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sap Archive - Upload</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Sap Archive â€” Upload</h1>

<div id="auth">
  <h3>Register / Login</h3>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="signup">Sign Up</button>
  <button id="login">Login</button>
  <button id="logout" style="display:none;">Logout</button>
  <p id="userInfo"></p>
</div>

<div id="uploader" style="display:none;">
  <h3>Upload file</h3>
  <input id="fileName" type="text" placeholder="File display name">
  <select id="category">
    <option value="videos">Videos</option>
    <option value="demos">Demos</option>
    <option value="photos">Photos</option>
    <option value="downloads">Downloads</option>
  </select>
  <input id="fileInput" type="file">
  <button id="uploadBtn">Upload</button>
  <p id="status"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  // ===== CONFIGURE AQUI =====
  const SUPABASE_URL = "https://your-project-ref.supabase.co";
  const SUPABASE_ANON_KEY = "your-anon-public-key";
  const BUCKET_NAME = "sap-files";
  // ==========================

  const supabase = supabaseLib.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // DOM
  const emailIn = document.getElementById('email');
  const passIn = document.getElementById('password');
  const signupBtn = document.getElementById('signup');
  const loginBtn = document.getElementById('login');
  const logoutBtn = document.getElementById('logout');
  const userInfo = document.getElementById('userInfo');
  const uploader = document.getElementById('uploader');
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const status = document.getElementById('status');
  const fileNameInput = document.getElementById('fileName');
  const categoryInput = document.getElementById('category');

  // Signup
  signupBtn.addEventListener('click', async () => {
    const { data, error } = await supabase.auth.signUp({
      email: emailIn.value,
      password: passIn.value
    });
    if(error) alert(error.message); else alert('Check your email for confirmation. Then login.');
  });

  // Login
  loginBtn.addEventListener('click', async () => {
    const { data, error } = await supabase.auth.signInWithPassword({
      email: emailIn.value,
      password: passIn.value
    });
    if(error) alert(error.message); else onAuthChange();
  });

  // Logout
  logoutBtn.addEventListener('click', async () => {
    await supabase.auth.signOut();
    onAuthChange();
  });

  // Auth state
  supabase.auth.getSession().then(onAuthChange);
  supabase.auth.onAuthStateChange((_event, session) => onAuthChange());

  async function onAuthChange() {
    const { data: { session } } = await supabase.auth.getSession();
    if(session && session.user){
      userInfo.textContent = `Logged in as ${session.user.email}`;
      logoutBtn.style.display = 'inline';
      uploader.style.display = 'block';
    } else {
      userInfo.textContent = 'Not logged in';
      logoutBtn.style.display = 'none';
      uploader.style.display = 'none';
    }
  }

  // Upload
  uploadBtn.addEventListener('click', async () => {
    const file = fileInput.files[0];
    if(!file) return alert('Select a file');
    const path = `${categoryInput.value}/${Date.now()}_${file.name}`;
    status.textContent = 'Uploading...';
    const { data, error } = await supabase.storage.from(BUCKET_NAME).upload(path, file);
    if(error) { status.textContent = error.message; return; }
    const { publicUrl } = supabase.storage.from(BUCKET_NAME).getPublicUrl(path);
    status.innerHTML = `Uploaded! <a href="${publicUrl}" target="_blank">Download</a>`;
  });
</script>
</body>
</html>
